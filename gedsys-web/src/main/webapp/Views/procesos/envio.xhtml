<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <body>
        <ui:composition template="./../../Template/plantilla.xhtml">
            <ui:define name="content">
                <c:if test="#{autorizationBean.hasAccess('envio') == true}">
                    <f:event type="preRenderView" listener="#{tipoDocumentoBean.listar()}" />
                    <f:event type="preRenderView" listener="#{entidadBean.listar()}" />
                    <f:event type="preRenderView" listener="#{transportadorBean.listar()}" />
                    <f:event type="preRenderView" listener="#{mediosRepEnvBean.listar()}" />
                    <p:growl id="messages"  showDetail="true" />
                    <div class="col-xs-12 x_panel">
                        <div class="x_title">
                            <h2>Envío de documentos<small>Digitalización o carga</small></h2>
                            <div class="clear"></div>
                        </div>
                        <div class="x_content">
                            <h:form id="form" enctype="multipart/form-data">
                                <div class="col-xs-6 form-group">
                                    <div class="col-xs-12">
                                        <label class=" col-xs-4" for="entidad">Entidad destino <span class="required">*</span>
                                        </label>
                                        <div class="col-xs-8">
                                            <p:selectOneMenu id="Entidad" value="#{envioBean.documento.entidad}" filter="true" filterMatchMode="startsWith" style="width: 100%" converter="omnifaces.SelectItemsConverter" required="true" requiredMessage="¡Error! Debe seleccionar la entidad de destino">
                                                <f:selectItem noSelectionOption="true" itemLabel="Seleccione la entidad" itemValue="#{null}" />
                                                <f:selectItems value="#{entidadBean.entidades}" var="entRem" itemLabel="#{entRem.nombre}" itemValue="#{entRem}" />
                                            </p:selectOneMenu>
                                        </div>
                                    </div>
                                    <div class="col-xs-12">
                                        <label class=" col-xs-4" for="direccion">Dirección <span class="required">*</span></label>
                                        <div class="col-xs-8">
                                            <p:inputText id="direccion" value="#{envioBean.documento.direccion}" style="width: 100%" required="true" requiredMessage="¡Error! La dirección no debe estar vacía"/>
                                        </div>
                                    </div>
                                    <div class="col-xs-12">
                                        <label class=" col-xs-4" for="municipio">Municipio<span class="required">*</span>
                                        </label>
                                        <div class="col-xs-8">
                                            <p:selectOneMenu id="municipio" value="#{envioBean.municipioId}" filter="true" 
                                                             filterMatchMode="startsWith" style="width: 100%" required="true" requiredMessage="¡Error! Debe seleccionar un municipio">
                                                <f:selectItem noSelectionOption="true" itemLabel="Seleccione un municipio" itemValue="#{null}" />
                                                <f:selectItems value="#{envioBean.municipios}" var="municipio" itemLabel="#{municipio.nombre}" itemValue="#{municipio.id}" />
                                            </p:selectOneMenu>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-6 form-group">
                                    <div class="col-xs-12">
                                        <label class=" col-xs-4" for="last-name">Fecha del documento</label>
                                        <div class="col-xs-8">
                                            <p:calendar id="fechaRecepcion" value="#{envioBean.documento.fechaCreacion}" showOn="button" locale="es" style="width: 100%" required="true" requiredMessage="¡Error! Debbe seleccionar una fecha válida"/>
                                        </div>
                                    </div>
                                    <div class="col-xs-12">
                                        <h:inputHidden id="consecutivo" value="#{envioBean.documento.consecutivo}" />
                                        <label class=" col-xs-4" for="tipoDocumentoExterno">Tipo de documento<span class="required">*</span></label>
                                        <div class="col-xs-8">
                                            <p:selectOneMenu id="tipoDocumento" value="#{envioBean.documento.tipoDocumento}" filter="true" filterMatchMode="startsWith" converter="omnifaces.SelectItemsConverter" style="width: 100%" required="true" requiredMessage="¡Error! Debe seleccionar el tipo de documento">
                                                <f:selectItem noSelectionOption="true" itemLabel="Seleccione el tipo de documento" itemValue="#{null}" />
                                                <f:selectItems value="#{tipoDocumentoBean.tipoDocumentos}" var="tipoDocumento" itemLabel="#{tipoDocumento.nombre}" itemValue="#{tipoDocumento}" />
                                            </p:selectOneMenu>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-12 form-group">
                                    <div class="col-xs-12">
                                        <label class=" col-xs-2" for="asunto">Asunto <span class="required">*</span>
                                        </label>
                                        <div class="col-xs-10" style="padding-left:0;">
                                            <p:inputText id="asunto" value="#{envioBean.documento.asunto}" style="width: 100%" required="true" requiredMessage="¡Error! El asunto no debe estar vacío"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-12 form-group">
                                    <div class="col-xs-12">
                                        <label class=" col-xs-2" for="detalle">Detalle <span class="required">*</span>
                                        </label>
                                        <div class="col-xs-10">
                                            <p:inputTextarea id="detalle" value="#{envioBean.documento.detalle}" rows="6" cols="220" style="width: 100%" counter="counter" maxlength="600" counterTemplate="{0} characters remaining." autoResize="false" required="true" requiredMessage="¡Error! El detalle no debe estar vacío" />
                                            <h:outputText id="counter" />
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-6 form-group">
                                    <div class="col-xs-12">
                                        <label class=" col-xs-4" for="libros">Descripción del anexo <span class="required"></span>
                                        </label>
                                        <div class="col-xs-8">
                                            <p:inputText id="libros" value="#{envioBean.documento.libros}" style="width: 100%"/>
                                        </div>
                                    </div>
                                    <div class="col-xs-12">
                                        <label class="col-xs-4" for="tercero">Empresa/Tercero de mensajería <span class="required">*</span>
                                        </label>
                                        <div class="col-xs-8">
                                            <p:selectOneMenu id="tercero" value="#{envioBean.documento.transportador}" filter="true" filterMatchMode="startsWith" style="width: 100%" converter="omnifaces.SelectItemsConverter" required="true" requiredMessage="¡Error! Debe seleccionar una empresa de mensajería">
                                                <f:selectItem noSelectionOption="true" itemLabel="Seleccione una empresa/tercero " itemValue="#{null}" />
                                                <f:selectItems value="#{transportadorBean.transportadores}" var="transportador" itemLabel="#{transportador.nombre}" itemValue="#{transportador}" />
                                            </p:selectOneMenu>

                                        </div>
                                    </div>
                                    <div class="col-xs-12">
                                        <label class=" col-xs-4" for="anexos">Anexos <span class="required"></span>
                                        </label>
                                        <div class="col-xs-8">
                                            <p:inputSwitch id="anexos" value="#{envioBean.documento.anexos}" onLabel="Sí" offLabel="No" />
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-6 form-group">
                                    <div class="col-xs-12">
                                        <label class=" col-xs-4" for="folios">Folios <span class="required">*</span>
                                        </label>
                                        <div class="col-xs-8">
                                            <p:inputNumber id="folios" value="#{envioBean.documento.folios}" decimalPlaces="0" minValue="0" style="width: 100%" required="true" requiredMessage="¡Error! Los folios no deben estar vacíos"/>
                                        </div>
                                    </div>
                                    <div class="col-xs-12">
                                        <label class=" col-xs-4" for="medioEnvio">Medio de envío <span class="required">*</span>
                                        </label>
                                         <div class="col-xs-8">
                                            <p:selectOneMenu id="medioEnvio" value="#{envioBean.documento.medioEnvio}" filter="true" filterMatchMode="startsWith" style="width: 100%" required="true" requiredMessage="¡Error! Debe seleccionar un medio de envío" converter="omnifaces.SelectItemsConverter">
                                                <f:selectItem noSelectionOption="true" itemLabel="Seleccione un medio de envío" itemValue="#{null}" />
                                                <f:selectItems value="#{mediosRepEnvBean.mediorecepciones}" var="medioEnvRep" itemLabel="#{medioEnvRep.nombre}" itemValue="#{medioEnvRep}" />
                                            </p:selectOneMenu>
                                        </div>                                       
                                    </div>
                                    <div class="col-xs-12">
                                        <label class=" col-xs-4">Adjuntar documento</label>
                                        <div class="col-xs-8">
                                            <p:fileUpload value="#{envioBean.documentFile}" fileUploadListener="#{envioBean.documentFile}"  mode="simple" skinSimple="true" sizeLimit="100000" allowTypes="/(\.|\/)(gif|jpe?g|png|pdf)$/" style="width: 100%" label="Adjuntar documento"  required="true"/>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xs-12 form-group">
                                    <div class="col-xs-12">
                                        <p:commandButton  widgetVar="genRad" class="btn-success" style="margin-left: 10px;" update=":form messages"  value="Generar radicado" icon="ui-icon-disk" actionListener="#{envioBean.generarConsectivo()}" ajax="true" partialSubmit="true" disabled="#{envioBean.canGenRad}"/>
                                        <p:commandButton  widgetVar="printRad" class="btn-info" style="margin-left: 10px;" icon="ui-icon-pencil" type="button" title="Imprimr radicado" value="Imprimir radicado" onclick="PF('denRadicado').show()" partialSubmit="false"  disabled="#{envioBean.canPrint}" ></p:commandButton>
                                        <p:commandButton  widgetVar="saveDoc" class="btn-primary" style="margin-left: 10px;" update="messages"  value="Enviar" icon="ui-icon-disk" actionListener="#{envioBean.radicar()}" ajax="false" partialSubmit="false" disabled="#{envioBean.canSave}"/>
                                        <p:commandButton class="btn-default" style="float: right;" value="Cancelar" immediate="true"></p:commandButton>
                                        <p:dialog id="dlgDetalle" header="Radicado" widgetVar="denRadicado" modal="true" showEffect="fade" hideEffect="fade" resizable="true" dynamic="true" width="80%" height="550" maximizable="true">
                                            <ui:include src="newRadicadoSalida.xhtml">
                                                <ui:param name="tipoRadicado" value="externo" />
                                                <ui:param name="consectivoExterno" value="#{envioBean.documento.consecutivo}" />
                                            </ui:include>
                                        </p:dialog>
                                    </div>
                                </div>
                            </h:form>
                        </div>    
                    </div>
                </c:if>
                <c:if test="#{autorizationBean.hasAccess('envio') == false}">
                    <h3>¡Lo sentimos, no tiene acceso a este módulo!</h3>
                </c:if>
            </ui:define>
        </ui:composition>
    </body>
</html>
