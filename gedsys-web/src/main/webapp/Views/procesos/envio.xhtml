<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <body>
        <ui:composition template="./../../Template/plantilla.xhtml">
            <ui:define name="content">
                <c:if test="#{autorizationBean.hasAccess('envio') == true}">
                <f:event type="preRenderView" listener="#{tipoDocumentoBean.listar()}" />
                <f:event type="preRenderView" listener="#{entidadBean.listar()}" />
                <f:event type="preRenderView" listener="#{transportadorBean.listar()}" />
                <p:growl id="messages"  showDetail="true" />
                <div class="x_panel">
                    <div class="x_title">
                        <h2>Envio de Documentos<small>Digitalización o Carga</small></h2>
                        <div class="clear"></div>
                    </div>

                    <div class="x_content">
                        <h:form id="form" enctype="multipart/form-data">
                            <div class="row">
                                <div class="col-xs-6 form-group">
                                    <label class=" col-xs-4" for="entidad">Entidad Destino <span class="required">*</span>
                                    </label>
                                    <div class="col-xs-8">
                                        <p:selectOneMenu id="Entidad" value="#{envioBean.documento.entidad}" filter="true" filterMatchMode="startsWith" style="width: 100%" converter="omnifaces.SelectItemsConverter">
                                            <f:selectItem noSelectionOption="true" itemLabel="Seleccione la entidad" itemValue="#{null}" />
                                            <f:selectItems value="#{entidadBean.entidades}" var="entRem" itemLabel="#{entRem.nombre}" itemValue="#{entRem}" />
                                        </p:selectOneMenu>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-6 form-group">
                                    <label class=" col-xs-4" for="direccion">Dirección <span class="required">*</span></label>
                                    <div class="col-xs-8">
                                        <p:inputText id="direccion" value="#{envioBean.documento.direccion}" style="width: 100%" required="true"/>
                                    </div>
                                </div>
                                <div class="col-xs-6 form-group">
                                    <label class=" col-xs-4" for="municipio">Municipio<span class="required">*</span>
                                    </label>
                                    <div class="col-xs-8">
                                        <p:selectOneMenu id="municipio" value="#{envioBean.municipioId}" filter="true" 
                                                         filterMatchMode="startsWith" style="width: 100%" required="true">
                                            <f:selectItem noSelectionOption="true" itemLabel="Seleccione un municipio" itemValue="#{null}" />
                                            <f:selectItems value="#{envioBean.municipios}" var="municipio" itemLabel="#{municipio.nombre}" itemValue="#{municipio.id}" />
                                        </p:selectOneMenu>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-6 form-group">
                                    <h:inputHidden id="consecutivo" value="#{envioBean.documento.consecutivo}" />
                                    <label class=" col-xs-4" for="tipoDocumentoExterno">Tipo de Documento<span class="required">*</span></label>
                                    <div class="col-xs-8">
                                        <p:selectOneMenu id="tipoDocumento" value="#{envioBean.documento.tipoDocumento}" filter="true" filterMatchMode="startsWith" converter="omnifaces.SelectItemsConverter" style="width: 100%" required="true">
                                            <f:selectItem noSelectionOption="true" itemLabel="Seleccione el tipo de documento" itemValue="#{null}" />
                                            <f:selectItems value="#{tipoDocumentoBean.tipoDocumentos}" var="tipoDocumento" itemLabel="#{tipoDocumento.nombre}" itemValue="#{tipoDocumento}" />
                                        </p:selectOneMenu>
                                    </div>
                                </div>
                                <div class="col-xs-6 form-group">
                                    <label class=" col-xs-4" for="last-name">Fecha del documento</label>
                                    <div class="col-xs-8">
                                        <p:calendar id="fechaRecepcion" value="#{envioBean.documento.fechaCreacion}" showOn="button" locale="es" style="width: 100%" />
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-6 form-group">
                                    <label class=" col-xs-4" for="asunto">Asunto <span class="required">*</span>
                                    </label>
                                    <div class="col-xs-8">
                                        <p:inputText id="asunto" value="#{envioBean.documento.asunto}" style="width: 100%"/>
                                    </div>
                                </div>

                                <div class="col-xs-6 col-xs-offset-6"></div>
                            </div>
                            <div class="row">
                                <div class="col-xs-12 form-group">
                                    <label class=" col-xs-2" for="detalle">Detalle <span class="required">*</span>
                                    </label>
                                    <div class="col-xs-10">
                                        <p:inputTextarea id="detalle" value="#{envioBean.documento.detalle}" rows="6" cols="220" style="width: 100%" counter="counter" maxlength="600" counterTemplate="{0} characters remaining." autoResize="false" />
                                        <h:outputText id="counter" />
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-6 form-group">
                                    <label class=" col-xs-4" for="anexos">Anexos <span class="required">*</span>
                                    </label>
                                    <div class="col-xs-8">
                                        <p:inputSwitch id="anexos" value="#{envioBean.documento.anexos}" onLabel="Sí" offLabel="No" />
                                    </div>
                                </div>
                                <div class="col-xs-6 form-group">
                                    <label class=" col-xs-4" for="folios">Folios <span class="required">*</span>
                                    </label>
                                    <div class="col-xs-8">
                                        <p:inputNumber id="folios" value="#{envioBean.documento.folios}" decimalPlaces="0" minValue="0" style="width: 100%"/>
                                    </div>
                                </div>
                            </div>
                            <div  class="row">
                                <div class="col-xs-6 form-group">
                                    <label class=" col-xs-4" for="libros">Descripción del Anexo <span class="required">*</span>
                                    </label>
                                    <div class="col-xs-8">
                                        <p:inputText id="libros" value="#{envioBean.documento.libros}" style="width: 100%"/>
                                    </div>
                                </div>
                                <div class="col-xs-6 form-group">
                                    <label class=" col-xs-4" for="medioEnvio">Medío de Envío <span class="required">*</span>
                                    </label>
                                    <div class="col-xs-8">
                                        <p:selectOneMenu id="medioEnvio" value="#{envioBean.documento.medioEnvio}" filter="true" filterMatchMode="startsWith" style="width: 100%" required="true">
                                            <f:selectItem noSelectionOption="true" itemLabel="Seleccione un medio de envío" itemValue="#{null}" />
                                            <f:selectItem itemLabel="Correo Electrónico" itemValue="Correo Electrónico" />
                                            <f:selectItem itemLabel="Correo Certificado" itemValue="Correo Certificado" />
                                            <f:selectItem itemLabel="Entrega Directa" itemValue="Entrega Directa" />
                                            <f:selectItem itemLabel="Fax" itemValue="Fax" />
                                        </p:selectOneMenu>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-6 form-group">
                                    <label class="col-xs-4" for="tercero">Empresa/Tercero de Mensajería <span class="required">*</span>
                                    </label>
                                    <div class="col-xs-8">
                                        <p:selectOneMenu id="tercero" value="#{envioBean.documento.transportador}" filter="true" filterMatchMode="startsWith" style="width: 100%" converter="omnifaces.SelectItemsConverter" required="true">
                                            <f:selectItem noSelectionOption="true" itemLabel="Seleccione una Empresa/Tercero " itemValue="#{null}" />
                                            <f:selectItems value="#{transportadorBean.transportadores}" var="transportador" itemLabel="#{transportador.nombre}" itemValue="#{transportador}" />
                                        </p:selectOneMenu>

                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-6 form-group">
                                    <label class=" col-xs-4">Adjuntar Documento</label>
                                    <div class="col-xs-8">
                                        <p:fileUpload value="#{envioBean.documentFile}" fileUploadListener="#{envioBean.documentFile}"  mode="simple" skinSimple="true" sizeLimit="100000" allowTypes="/(\.|\/)(gif|jpe?g|png|pdf)$/" style="width: 100%" label="Adjuntar documento"  required="true"/>
                                    </div>
                                </div>
                            </div>
                                                        
                            <div class="ln_solid"></div>
                            <div class="form-group">
                                <div class="col-xs-6 col-sm-6 col-xs-12 col-xs-offset-6">
                                    <p:commandButton update=":form messages"  value="Generar Radicado" icon="ui-icon-disk" actionListener="#{envioBean.generarConsectivo()}" ajax="true" partialSubmit="true"/>
                                    <p:commandButton icon="ui-icon-pencil" type="button" title="Imprimr Radicado" value="Imprimir Radicado" onclick="PF('denRadicado').show()" partialSubmit="false"></p:commandButton>
                                    <p:commandButton update="messages"  value="Enviar" icon="ui-icon-disk" actionListener="#{envioBean.radicar()}" ajax="false" partialSubmit="false"/>
                                    <p:commandButton value="Cancelar" immediate="true"></p:commandButton>
                                    <p:dialog id="dlgDetalle" header="Radicado" widgetVar="denRadicado" modal="true" showEffect="fade" hideEffect="fade" resizable="false" dynamic="true">
                                        <ui:include src="newRadicadoSalida.xhtml">
                                            <ui:param name="tipoRadicado" value="externo" />
                                            <ui:param name="consectivoExterno" value="#{envioBean.documento.consecutivo}" />
                                        </ui:include>
                                    </p:dialog>
                                </div>
                            </div>
                        </h:form>
                    </div>    
                </div>
                </c:if>
                <c:if test="#{autorizationBean.hasAccess('envio') == false}">
                    <h3>¡Lo sentimos, no tiene acceso a este módulo!</h3>
                </c:if>
            </ui:define>
        </ui:composition>
    </body>
</html>
